<nav class="navbar">
  <div class="navbar-container">
    <!-- Logo: Editorial Style -->
    <a routerLink="/" class="navbar-brand" (click)="closeMobileMenu()">
      <!-- We can keep the spans, but style them to look like one word or a logo -->
      <span class="brand-logo">01</span>
      <span class="brand-name">Blog</span>
    </a>

    <!-- Desktop Menu -->
    <div class="navbar-desktop">
      <div class="navbar-actions">
        <!-- Theme Toggle -->
        <app-theme-toggle></app-theme-toggle>

        <!-- Guest View -->
        @if (!isLoggedIn) {
        <a routerLink="/auth/login" class="nav-link">Sign in</a>
        <a routerLink="/auth/register" class="nav-btn primary">Get started</a>
        }

        <!-- Logged In View -->
        @if (isLoggedIn) {
        <!-- We usually hide the username text on desktop for a cleaner look -->
        @if (!isAdmin) {

        <div class="notification-container">
          <button class="nav-btn-icon" (click)="toggleNotifications()">
            <!-- Simple Bell SVG -->
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
              <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
            </svg>

            @if (unreadCount > 0) {
            <span class="notification-badge">{{ unreadCount > 9 ? '9+' : unreadCount }}</span>
            }
          </button>

          <!-- Dropdown -->
          @if (isNotificationOpen) {
          <div class="notification-dropdown">
            <div class="dropdown-header">Notifications</div>
            <div class="dropdown-list">
              @if (notifications.length === 0) {
              <div class="empty-state">No notifications yet.</div>
              } @for (notif of notifications; track notif.id) {
              <div
                class="notif-item"
                [class.unread]="!notif.read"
                (click)="markRead(notif)"
                [routerLink]="['/posts', notif.post.id]"
              >
                <p class="notif-msg">{{ notif.message }}</p>
                <span class="notif-date">{{ notif.createdAt | date : 'short' }}</span>
              </div>
              }
            </div>
          </div>
          }
        </div>
        }
        <div class="user-menu-trigger">
          <img
            [src]="avatarUrl"
            class="nav-avatar"
            [routerLink]="['/profile', userId]"
            [alt]="username"
          />
        </div>
        <button (click)="logout()" class="nav-link logout">Sign out</button>
        }
      </div>
    </div>

    <!-- Mobile Menu Button -->
    <div class="navbar-mobile-controls">
      <app-theme-toggle></app-theme-toggle>

      @if (isLoggedIn && !isAdmin) {
      <div class="notification-container mobile-bell">
        <button class="nav-btn-icon" (click)="toggleNotifications()">
          <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
          </svg>

          @if (unreadCount > 0) {
          <span class="notification-badge">{{ unreadCount > 9 ? '9+' : unreadCount }}</span>
          }
        </button>

        <!-- Mobile Dropdown -->
        @if (isNotificationOpen) {
        <div class="notification-dropdown mobile-dropdown">
          <div class="dropdown-header">Notifications</div>
          <div class="dropdown-list">
            @if (notifications.length === 0) {
            <div class="empty-state">No notifications yet.</div>
            } @for (notif of notifications; track notif.id) {
            <div
              class="notif-item"
              [class.unread]="!notif.read"
              (click)="markRead(notif)"
              [routerLink]="['/posts', notif.post.id]"
            >
              <p class="notif-msg">{{ notif.message }}</p>
              <span class="notif-date">{{ notif.createdAt | date : 'short' }}</span>
            </div>
            }
          </div>
        </div>
        }
      </div>
      }
      <button
        class="hamburger"
        (click)="toggleMobileMenu()"
        [class.active]="isMobileMenuOpen"
        aria-label="Toggle menu"
      >
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
      </button>
    </div>
  </div>

  <!-- Mobile Menu Dropdown -->
  <div class="mobile-menu" [class.open]="isMobileMenuOpen">
    <div class="mobile-menu-content">
      @if (!isLoggedIn) {
      <a routerLink="/auth/login" class="mobile-link" (click)="closeMobileMenu()">Sign in</a>
      <a routerLink="/auth/register" class="mobile-link primary" (click)="closeMobileMenu()"
        >Get started</a
      >
      } @if (isLoggedIn) {
      <div
        class="mobile-user-profile"
        [routerLink]="['/profile', userId]"
        (click)="closeMobileMenu()"
      >
        @if (avatarUrl) {
        <img [src]="avatarUrl" class="mobile-avatar" [alt]="username" />
        }
        <span class="mobile-username">{{ username }}</span>
      </div>
      <button (click)="logout()" class="mobile-link logout">Sign out</button>
      }
    </div>
  </div>
</nav>

<!-- Overlay -->
<div class="mobile-overlay" [class.visible]="isMobileMenuOpen" (click)="closeMobileMenu()"></div>
