<div class="login-page settings-page">
  <div class="login-container">
    <form [formGroup]="publicInfoForm" (ngSubmit)="onSubmit()">
      <!-- Header -->
      <div class="title">
        <h1>Profile Information</h1>
        <p>Update your photo and personal details.</p>
      </div>

      <!-- Profile Image Section -->
      <div class="profile-upload-section">
        <div class="avatar-wrapper">
          @if (avatarPreview) {
          <img [src]="avatarPreview" alt="Avatar Preview" />
          } @else {
          <div class="avatar-placeholder">
            {{ user?.username?.charAt(0) || '?' | uppercase }}
          </div>
          }
        </div>

        <div class="upload-actions">
          <button type="button" mat-stroked-button color="primary" (click)="fileInput.click()">
            Update photo
          </button>

          <input #fileInput type="file" (change)="onFileSelected($event)" accept="image/*" hidden />

          <span class="upload-hint">Recommended: Square JPG, PNG.</span>

          @if (fileError) {
          <div class="error-msg">
            <small>{{ fileError }}</small>
          </div>
          }
        </div>
      </div>

      <!-- Split Inputs -->
      <div class="form-row">
        <mat-form-field appearance="fill" class="half-width">
          <mat-label>First name</mat-label>
          <input matInput formControlName="firstname" />
        </mat-form-field>

        <mat-form-field appearance="fill" class="half-width">
          <mat-label>Last name</mat-label>
          <input matInput formControlName="lastname" />
        </mat-form-field>
      </div>

      <div class="form-row single-col">
        <mat-form-field appearance="fill" class="full-width">
          <mat-label>Email</mat-label>
          <input matInput type="email" formControlName="email" />
        </mat-form-field>

        <mat-form-field appearance="fill" class="full-width">
          <mat-label>Username</mat-label>
          <input matInput formControlName="username" />
        </mat-form-field>

        <mat-form-field appearance="fill" class="full-width">
          <mat-label>Short Bio</mat-label>
          <textarea
            matInput
            formControlName="bio"
            rows="3"
            placeholder="Tell your story..."
          ></textarea>
          @if (publicInfoForm.get('bio')?.invalid) {
          <mat-error>Bio is required.</mat-error>
          }
        </mat-form-field>
      </div>

      <!-- Section Divider -->
      <div class="section-divider">
        <span>Security</span>
      </div>

      <div class="form-row single-col">
        <mat-form-field appearance="fill" class="full-width">
          <mat-label>Old Password</mat-label>
          <input matInput type="password" formControlName="oldpassword" />
        </mat-form-field>

        <mat-form-field appearance="fill" class="full-width">
          <mat-label>New Password</mat-label>
          <input matInput type="password" formControlName="password" />
        </mat-form-field>
      </div>

      @if (errorMessage) {
      <div class="error-banner">
        <p>{{ errorMessage }}</p>
      </div>
      }

      <div class="actions">
        <!-- Save Button (Green) -->
        <button
          mat-flat-button
          color="primary"
          class="save-btn"
          type="submit"
          [disabled]="publicInfoForm.invalid || publicInfoForm.pristine"
        >
          Save
        </button>
      </div>
    </form>
  </div>
</div>
