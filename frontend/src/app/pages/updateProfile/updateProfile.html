<div class="login-page settings-page">
  <div class="login-container">
    <form [formGroup]="publicInfoForm" (ngSubmit)="onSubmit()">
      <div class="title">
        <h1>Profile Information</h1>
        <p>Update your photo and personal details.</p>
      </div>

      <!-- Profile Image Section (Moved to Top) -->
      <div class="profile-upload-section">
        <div class="avatar-wrapper">
          @if (avatarPreview) {
          <img [src]="avatarPreview" alt="Avatar Preview" />
          } @else {
          <div class="avatar-placeholder">
            {{ user?.username?.charAt(0) | uppercase }}
          </div>
          }
        </div>

        <div class="upload-actions">
          <label for="fileInput" class="upload-btn">Update photo</label>
          <input
            id="fileInput"
            type="file"
            (change)="onFileSelected($event)"
            accept="image/*"
            hidden
          />
          <span class="upload-hint">Recommended: Square JPG, PNG.</span>

          @if (fileError) {
          <div class="error">
            <small>{{ fileError }}</small>
          </div>
          }
        </div>
      </div>

      <!-- Split Inputs -->
      <div class="form-row">
        <div class="input-group">
          <label>First name</label>
          <input type="text" formControlName="firstname" [placeholder]="user?.firstname || ''" />
        </div>
        <div class="input-group">
          <label>Last name</label>
          <input type="text" formControlName="lastname" [placeholder]="user?.lastname || ''" />
        </div>
      </div>

      <div class="input-group">
        <label>Email</label>
        <input type="email" formControlName="email" [placeholder]="user?.email" />
      </div>

      <div class="input-group">
        <label>Username</label>
        <input type="text" formControlName="username" [placeholder]="user?.username" />
      </div>

      <div class="input-group">
        <label>Short Bio</label>
        <textarea
          formControlName="bio"
          [placeholder]="user?.bio || 'Tell your story...'"
          rows="3"
        ></textarea>

        @if (publicInfoForm.get('bio')?.touched && publicInfoForm.get('bio')?.invalid) {
        <div class="error"><small>Bio is required.</small></div>
        }
      </div>

      <!-- Password Section Divider -->
      <div class="section-divider">
        <span>Security</span>
      </div>

      <div class="input-group">
        <label>Old Password</label>
        <input type="password" formControlName="oldpassword" placeholder="••••••••" />
      </div>

      <div class="input-group">
        <label>New Password</label>
        <input type="password" formControlName="password" placeholder="••••••••" />
      </div>

      @if (errorMessage) {
      <div class="error-banner">
        <p>{{ errorMessage }}</p>
      </div>
      }

      <div class="actions">
        <!-- Save Button (Green style specific to Medium 'Publish/Save' actions, or Black based on your Global) -->
        <button
          class="main-btn save-btn"
          type="submit"
          [disabled]="publicInfoForm.invalid || publicInfoForm.pristine"
        >
          Save
        </button>
      </div>
    </form>
  </div>
</div>
