@if (user) {
<div class="profile-page-container">
  <!-- 1. Minimal Profile Header -->
  <header class="profile-header">
    <div class="header-content">
      <div class="info-group">
        <h1 class="profile-name">{{ user.lastname }} {{ user.firstname }}</h1>
        <p class="profile-username">@{{ user.username }}</p>

        @if (user.bio) {
        <p class="profile-bio">{{ user.bio }}</p>
        } @else {
        <p class="profile-bio empty">Writer on Blog.</p>
        }

        <div class="profile-meta-row">
          <span class="meta-item">
            <strong>{{ user.followersCount || 0 }}</strong> Followers
          </span>
          <span class="meta-item">
            <strong>{{ user.followingCount || 0 }}</strong> Following
          </span>

          <!-- Edit / Follow Actions -->
          <div class="action-buttons">
            @if (isCurrentUser) {
            <!-- Edit Profile: Simple Text Link Button -->
            <a
              mat-button
              color="accent"
              [routerLink]="['/profile/update', user.id]"
              class="text-btn"
            >
              Edit profile
            </a>

            <!-- Write: Primary Pill Button (Override CSS) -->
            <a mat-flat-button color="primary" routerLink="/new-story" class="write-btn">Write</a>

            } @else if (isAdmin){
            <a
              mat-button
              color="accent"
              [routerLink]="['/profile/update', user.id]"
              class="text-btn"
            >
              Edit profile
            </a>

            } @else {
            <!-- Follow Button Logic -->
            @if (user.following) {
            <!-- Already Following: Stroked Button (Green Text) -->
            <button
              mat-stroked-button
              color="primary"
              class="follow-btn active"
              (click)="toggleFollow()"
            >
              Following
            </button>
            } @else {
            <!-- Not Following: Flat Button (Green Bg) -->
            <button mat-flat-button color="primary" class="follow-btn" (click)="toggleFollow()">
              Follow
            </button>
            } }
          </div>
        </div>
      </div>

      <!-- Avatar on Right (Desktop) or Top (Mobile) -->
      <div class="avatar-group">
        <img
          [src]="user.avatarUrl ? user.avatarUrl : '/default-avatar.jpg'"
          alt="Avatar"
          class="profile-avatar"
          onerror="this.src='/default-avatar.jpg'"
        />
      </div>
    </div>
  </header>

  <div class="content-divider"></div>

  <!-- 2. User's Posts Feed (List View) -->
  <section class="user-feed">
    <h3 class="section-title">{{ isCurrentUser ? 'Your stories' : 'Latest' }}</h3>

    @if (user.posts.length > 0) {
    <div class="posts-list">
      @for (p of user.posts; track $index) {
      <article class="feed-item">
        <div class="item-content" [routerLink]="['/posts', p.id]">
          <div class="text-content">
            <span class="post-date">{{ p.createdAt | date : 'MMM d, y' }}</span>
            <h2 class="post-title">{{ p.title }}</h2>
            <p class="post-snippet">{{ p.description }}</p>
            <div class="post-footer">
              <span>Read more...</span>
            </div>
          </div>

          <!-- Thumbnail if exists -->
          @if (p.mediaUrl) {
          <div class="media-thumbnail">
            @if (p.mediaType === 'IMAGE') {
            <img [src]="'http://localhost:8080' + p.mediaUrl" />
            } @if (p.mediaType === 'VIDEO') {
            <video [src]="'http://localhost:8080' + p.mediaUrl"></video>
            }
          </div>
          }
        </div>
        <div class="item-divider"></div>
      </article>
      }
    </div>
    } @else {
    <div class="empty-state">
      <p>No stories published yet.</p>
    </div>
    }
  </section>
</div>
} @else {
<div class="loading-state">
  <mat-spinner diameter="40"></mat-spinner>
  <p>Loading profile...</p>
</div>
}
