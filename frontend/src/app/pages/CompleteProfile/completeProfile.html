<div class="login-page onboarding-page">
  <div class="login-container">
    <form [formGroup]="publicInfoForm" (ngSubmit)="onSubmit()">
      <!-- Header -->
      <div class="title">
        <h1>Complete Your Profile</h1>
        <p>Help readers know who you are.</p>
      </div>

      <!-- 1. Avatar Section -->
      <div class="avatar-upload-section">
        <div class="avatar-wrapper" (click)="fileInput.click()">
          <!-- Preview or Placeholder -->
          <div class="avatar-circle">
            @if (avatarPreview()) {
            <img [src]="avatarPreview()" alt="Preview" />
            } @else {
            <div class="placeholder">
              <!-- Safe access to form control value -->
              {{ publicInfoForm.controls.firstname.value?.charAt(0) || '?' | uppercase }}
            </div>
            }

            <!-- Overlay Icon on Hover -->
            <div class="avatar-overlay">
              <mat-icon>photo_camera</mat-icon>
            </div>
          </div>
        </div>

        <div class="upload-trigger">
          <button type="button" mat-button color="primary" (click)="fileInput.click()">
            Add a photo
          </button>

          <input #fileInput type="file" (change)="onFileSelected($event)" accept="image/*" hidden />

          @if (fileError()) {
          <span class="error-msg">{{ fileError() }}</span>
          }
        </div>
      </div>

      <!-- 2. Name Fields (Side by Side) -->
      <div class="form-row">
        <!-- First Name -->
        <mat-form-field appearance="fill" class="half-width">
          <mat-label>First Name</mat-label>
          <input matInput formControlName="firstname" placeholder="Jane" />
          @if (publicInfoForm.controls.firstname.hasError('minlength')) {
          <mat-error>Name is too short</mat-error>
          }
        </mat-form-field>

        <!-- Last Name -->
        <mat-form-field appearance="fill" class="half-width">
          <mat-label>Last Name</mat-label>
          <input matInput formControlName="lastname" placeholder="Doe" />
          @if (publicInfoForm.controls.lastname.hasError('minlength')) {
          <mat-error>Name is too short</mat-error>
          }
        </mat-form-field>
      </div>

      <!-- 3. Bio -->
      <div class="form-row single-col">
        <mat-form-field appearance="fill" class="full-width">
          <mat-label>Short Bio</mat-label>
          <textarea
            matInput
            formControlName="bio"
            placeholder="Tell your story..."
            rows="3"
            cdkTextareaAutosize
          ></textarea>
          <!-- Using .value accessor safely -->
          <mat-hint align="end"
            >{{ publicInfoForm.controls.bio.value?.length || 0 }} chars</mat-hint
          >
          @if (publicInfoForm.controls.bio.hasError('minlength')) {
          <mat-error>Bio must be at least 10 characters.</mat-error>
          }
        </mat-form-field>
      </div>

      <!-- 4. Actions -->
      <div class="actions">
        <!-- Continue -->
        <button
          mat-flat-button
          color="primary"
          type="submit"
          class="action-btn"
          [disabled]="publicInfoForm.invalid || isSubmitting()"
        >
          {{ isSubmitting() ? 'Saving...' : 'Continue' }}
        </button>

        <!-- Skip -->
        <button
          mat-button
          type="button"
          class="skip-btn"
          (click)="skip()"
          [disabled]="isSubmitting()"
        >
          I'll do this later
        </button>
      </div>
    </form>
  </div>
</div>
